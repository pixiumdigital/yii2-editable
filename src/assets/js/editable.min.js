!function(e){"use strict";var t,i;t={NAMESPACE:".editable",isEmpty:function(t,i){return null===t||void 0===t||0===t.length||i&&""===e.trim(t)},addCss:function(e,t){e.removeClass(t).addClass(t)},handler:function(e,i,o){var a=i+t.NAMESPACE;e.off(a).on(a,o)},raise:function(t,i,o){var a=e.Event(i);return void 0!==o?t.trigger(a,o):t.trigger(a),!a.isDefaultPrevented()}},(i=function(t,i){this.$container=e(t),this.init(i),this.destroy(),this.create()}).prototype={constructor:i,init:function(t){var i=this,o=i.$container;i.$input=o.find(".kv-editable-input"),i.$form=o.find(".kv-editable-form"),i.$value=o.find(".kv-editable-value"),i.$close=o.find(".kv-editable-close"),i.$popover=o.find(".kv-editable-popover"),i.$inline=o.find(".kv-editable-inline"),i.$btnSubmit=o.find("button.kv-editable-submit"),i.$btnReset=o.find("button.kv-editable-reset"),i.$loading=o.find(".kv-editable-loading"),i.$target=o.find(t.target),e.each(t,function(e,t){i[e]=t}),i.$targetEl=".kv-editable-button"===i.target?i.$target:i.$value,i.initActions()},initActions:function(){var i,o=this,a=o.$form,n=a.parent(),r=o.$container,s=o.$inline,l=o.$loading,c=o.$input,u="",d="",f=a.data("yiiActiveForm"),h=c.closest(".field-"+c.attr("id")),p=h.find(".help-block"),v=c.closest(".kv-editable-parent"),m=o.displayValueConfig,b=a.find('input[name="hasEditable"]'),g=t.isEmpty(h.attr("class"))||t.isEmpty(p.attr("class")),y=v.find(".kv-help-block");i=function(i){g?(y.length||(y=e(document.createElement("div")).attr({class:"help-block kv-help-block"}).appendTo(v)),y.html(i).show()):(t.addCss(p,"kv-help-block"),p.html(i).show()),t.addCss(v,"has-error"),l.hide(),n.removeClass("kv-editable-processing")},o.actions={formReset:function(){setTimeout(function(){a.data("kvEditableSubmit",!1),g?(v.find(".help-block").remove(),v.removeClass("has-error")):(h.removeClass("has-error"),p.html(" ")),o.refreshPopover()},o.resetDelay)},formSubmit:function(e){e.preventDefault()},formChange:function(){t.raise(r,"editableChange",[c.val()])&&o.refreshPopover()},formKeyup:function(e){13===e.which&&o.submitOnEnter&&(o.submitFlag=!0,o.actions.submitClick())},formBlur:function(e){var t=e.delegateTarget;setTimeout(function(){t.contains(document.activeElement)||o.submitFlag||!o.closeOnBlur||o.toggle(!1)},0)},inlineKeyup:function(e){27===e.which&&o.actions.closeClick()},closeClick:function(){o.toggle(!1)},targetClick:function(){var e;o.submitFlag=!1,o.asPopover?o.toggle(!0):(e=!s.is(":visible"),o.toggle(e))},resetClick:function(){t.raise(r,"editableReset")&&(b.val(0),setTimeout(function(){a[0].reset()},o.resetDelay))},submitClick:function(){var E,k=o.asPopover?n:s,$=!1;console.log("noob"),t.addCss(k,"kv-editable-processing"),l.show(),b.val(1),a.find(".help-block").each(function(){e(this).html("")}),a.find(".has-error").removeClass("has-error"),a.find("input, select").each(function(){var i=e(this),o=i.val(),a=o,n="file"===i.attr("type");$||($=n),i.attr("disabled")||(n?t.raise(i,"blur"):(e.isArray(o)?a.push("-"):a+="-",i.val(a),t.raise(i,"blur"),i.val(o),t.raise(i,"blur")))}),E={type:a.attr("method"),url:a.attr("action"),dataType:"json",beforeSend:function(e){t.raise(r,"editableBeforeSubmit",[e])||e.abort()},error:function(e,a,n){t.raise(r,"editableAjaxError",[e,a,n])&&o.showAjaxErrors&&i(n)},success:function(n,s,b){u="",d=t.isEmpty(n.output)?o.htmlEncode(c.val()):n.output,o.refreshPopover(),t.isEmpty(n.message)?(t.isEmpty(y.attr("class"))||(h.removeClass("has-error"),y.html("").hide(),p.html("")),a.find(".help-block").each(function(){var i=e(this).text();u+=i?i.trim():"",t.isEmpty(u)||l.hide()}),t.isEmpty(u)?t.raise(r,"editableSuccess",[c.val(),a,n,s,b])&&(l.hide(),t.isEmpty(d)?(console.log("hisempty"),d=o.valueIfNull):(void 0!==m[d]&&(d=m[d]),console.log("displayvalue")),g?(console.log("not active form"),v.find(".help-block").remove(),v.removeClass("has-error"),p.html(""),o.toggle(!1),o.$value.html(d)):(console.log("active form"),h.removeClass("has-error"),p.html(""),o.toggle(!1),o.$value.html(d),f&&(a.yiiActiveForm("destroy"),a.yiiActiveForm(f.attributes,f.settings)))):t.raise(r,"editableError",[c.val(),a,n]),k.removeClass("kv-editable-processing")):t.raise(r,"editableError",[c.val(),a,n])&&i(n.message)}},$&&window.FormData?(a.attr("enctype","multipart/form-data"),E.data=new FormData(a[0]),E.contentType=!1,E.processData=!1,E.cache=!1):E.data=a.serialize(),setTimeout(function(){t.raise(r,"editableSubmit",[c.val(),a])&&e.ajax(e.extend(!0,E,o.ajaxSettings))},o.validationDelay)}}},htmlEncode:function(t){var i=this;return i.encodeOutput?"object"==typeof t?(e.each(t,function(e,o){t[e]=i.htmlEncode(o)}),t):t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):t},toggle:function(e){var i=this,o=i.$value,a=i.$inline,n=i.animationDelay,r=function(){i.$btnSubmit.focus(),i.selectAllOnEdit&&i.$input.select()};if(e)return i.asPopover?void r():void o.fadeOut(n,function(){a.fadeIn(n,function(){r()}),".kv-editable-button"===i.target&&t.addCss(i.$target,"kv-inline-open")});i.asPopover?i.$popover.popoverX("hide"):a.fadeOut(n,function(){o.fadeIn(n),i.$target.removeClass("kv-inline-open")})},refreshPopover:function(){this.asPopover&&this.$popover.popoverX("refreshPosition")},destroy:function(){this.$form.off(t.NAMESPACE),this.$form.find("input, select").off(t.NAMESPACE),this.$close.off(t.NAMESPACE),this.$inline.off(t.NAMESPACE),this.$popover.off(t.NAMESPACE),this.$btnSubmit.off(t.NAMESPACE),this.$btnReset.off(t.NAMESPACE),this.$targetEl.off(t.NAMESPACE)},create:function(){var i=this.actions,o=this.$form,a=this.$inline;t.handler(o,"reset",e.proxy(i.formReset,this)),t.handler(o,"submit",e.proxy(i.formSubmit,this)),t.handler(o.find("input, select"),"change",e.proxy(i.formChange,this)),t.handler(o,"keyup",e.proxy(i.formKeyup,this)),this.asPopover?t.handler(this.$popover,"focusout",e.proxy(i.formBlur,this)):(t.handler(a,"keyup",e.proxy(i.inlineKeyup,this)),t.handler(a,"focusout",e.proxy(i.formBlur,this))),t.handler(this.$btnReset,"click",e.proxy(i.resetClick,this)),t.handler(this.$btnSubmit,"click",e.proxy(i.submitClick,this)),t.handler(this.$close,"click",e.proxy(i.closeClick,this)),t.handler(this.$targetEl,"click",e.proxy(i.targetClick,this))}},e.fn.editable=function(t){var o=Array.apply(null,arguments);return o.shift(),this.each(function(){var a=e(this),n=a.data("editable"),r="object"==typeof t&&t;n||(n=new i(this,e.extend({},e.fn.editable.defaults,r,e(this).data())),a.data("editable",n)),"string"==typeof t&&n[t].apply(n,o)})},e.fn.editable.defaults={valueIfNull:"<em>(not set)</em>",placement:"right",displayValueConfig:{},ajaxSettings:{},showAjaxErrors:!0,submitOnEnter:!0,selectAllOnEdit:!0,asPopover:!0,encodeOutput:!0,closeOnBlur:!0,validationDelay:500,resetDelay:200,animationDelay:300},e.fn.editable.Constructor=i}(window.jQuery);